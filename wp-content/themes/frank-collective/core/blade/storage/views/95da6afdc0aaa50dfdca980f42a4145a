<?php /* Template Name: Case Study */ ?>
<?php \Laravel\Section::start('content'); ?>
<?php

    $current_section_id = 0;
    $nav_sections = [];

    if(get_field('banner_in_top_menu') && get_field('banner_menu_label')){
	    $nav_sections[] = get_field('banner_menu_label');
	    $current_section_id ++;
    }

    if(!empty(get_field('flexible_content_sections'))){
        foreach(get_field('flexible_content_sections') as $section){
        	if($section['in_top_menu'] && $section['menu_label']){
		        $nav_sections[] = $section['menu_label'];
            }
        }
    }

    $nav = [
    	'title' => get_field('brand_name'),
        'sections' => $nav_sections
    ]
?>
<?php while ( have_posts() ) : the_post(); ?>
<div class="root barba-container" data-namespace="case_study" data-page-id="Case_study" data-transition-in="case_study_in" data-transition-out="case_study_out" data-page-init="case_study_init">
    <?php echo view('partials/case-study/case-nav', $nav)->with(get_defined_vars())->render(); ?>
    <?php if(get_field('main_image') || get_field('hero_section_image') || get_field('hero_section_video')): ?>
        <?php if(get_field('hero_section_video')): ?>
            <div class="case-hero-banner video-banner"
                 <?php if(get_field('banner_in_top_menu') && get_field('banner_menu_label')): ?>
                 id="section-0" data-nav-section="section-0"
                 <?php endif; ?>
                 <?php if(get_field('main_banner_navigation_color') === 'light'): ?>
                 data-dark
                <?php endif; ?>
            >
                <div class="video-wrap">
                    <video autoplay muted loop playsinline class="video ajax-preload-assets">
                        <source src="<?php echo  get_field('hero_section_video') ; ?>" type="video/mp4">
                    </video>
                </div>
            </div>
        <?php else: ?>
			<?php $image = get_field('hero_section_image') ? get_field('hero_section_image') : get_field('main_image'); ?>
            <div class="case-hero-banner" style="background-image: url('<?php echo  helper::imageURL($image, 'full') ; ?>');" data-ajax-preload-assets="<?php echo  helper::imageURL($image, 'full') ; ?>"
                <?php if(get_field('banner_in_top_menu') && get_field('banner_menu_label')): ?>
                 id="section-0" data-nav-section="section-0"
                <?php endif; ?>
                <?php if(get_field('main_banner_navigation_color') === 'light'): ?>
                 data-dark
                <?php endif; ?>
            ></div>
        <?php endif; ?>
    <?php endif; ?>

    <?php if(!empty(get_field('flexible_content_sections'))): ?>
        <?php foreach(get_field('flexible_content_sections') as $section): ?>
            <?php
			$section_id = false;
			if($section['in_top_menu'] && $section['menu_label']) {
				$section_id = 'section-'.$current_section_id;
				$current_section_id ++;
			}
			?>
            <?php echo view('components/case-study/' . $section['acf_fc_layout'], ['section_id' => $section_id])->with(get_defined_vars())->render(); ?>
        <?php endforeach; ?>
    <?php endif; ?>
    <?php if(!get_field('disable_contact_us_section')): ?>
        <?php echo view('partials/cta/contact')->with(get_defined_vars())->render(); ?>
    <?php endif; ?>
    <?php echo view('partials/case-study/case-related')->with(get_defined_vars())->render(); ?>
</div>
<?php endwhile ?>
<?php \Laravel\Section::stop(); ?>
<?php echo view('layouts/master', ['headerCaseStudy' => true])->with(get_defined_vars())->render(); ?>